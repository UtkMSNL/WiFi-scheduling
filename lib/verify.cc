#include <cstring>
#include "verify.h"
#include <itpp/itcomm.h>	// for vec

const char ref_data_bits_24qam[1295] = "0000000000000000000100000000000000000000000000000100001001000010010000100100001001000010010000101100010011000100110001001100010011000100110001001111111111111111111111111111111111111111111111110000000000000000100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101010011010100110101001101000110000011101000000111111000000000000";

const char ref_encoded_bits_24qam[2589] =  "00000000000000000000000000000000000000110111110010110000000000000000000000000000000000000000000000110111110001101100010100000110110001010000011011000101000001101100010100000110110001010000011000011010000100000010001111010000001000111101000000100011110100000010001111010000001000111101000000101101100011111111111111111111111111111111111111111111111111111111111111111111111111111111111100011001011100000000000000000000110111001000001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000101011001001000010101100100100001010110010010000100110000001001110010010010111001010111011111001101000000110010111000000000000";

const int ref_nonMarker_24qam[] = {0,0,0,0,0,0,0,3,19,20,14,0,0,0,0,0,0,0,0,0,21,23,3,18,5,0,21,9,16,3,18,5,0,21,9,16,3,18,5,0,20,6,8,8,4,19,12,1,3,21,0,16,19,12,1,3,21,0,16,19,12,1,18,20,19,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,9,10,22,0,0,0,1,15,4,2,14,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,5,18,16,8,13,10,16,4,20,1,7,4,10,22,17,19,19,20,21,0,18,17,20,0,0};

const int ref_marker_24qam[] = {7,5,6,4,4,4,6,4,3,0,0,0,5,6,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,2,3};

double calcINTDiffRate(const int * decoded, const int * ref, int nItems, bool debug) {
	int nErr = 0;
	for(int i=0;i<nItems;i++) {
		if(debug) {
			std::cout << std::setw(4) << std::setfill('0') << i << ": decoded = " << decoded[i] << ", reference = " << ref[i];
		}
		if(decoded[i] != ref[i]) {
			nErr++;
			if(debug) {
				std::cout << ", error " << nErr << std::endl;
			}
		}
		else {
			if(debug) {
				std::cout << std::endl;
			}
		}
	}
	return 1.0*nErr/nItems;
}
